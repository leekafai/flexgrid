## 目标

* 在真实浏览器环境下精准捕获卡片DOM样式与模型位置的变化轨迹，定位“闪回至拖拽前位置”的根因。

* 通过MutationObserver与帧级采样输出结构化日志，方便你把日志贴给我进行远程分析。

## 埋点内容

* 事件分类：

  * `placementStart/placementEnd`：放置动画起止

  * `mousemove/mouseup/drop`：输入事件关键节点

  * `mutation`：DOM属性变化（`style/class`）

  * `stylePoll`：每帧采样的样式（`left/top/transform/position/zIndex/transition`）

  * `rectPoll`：每帧采样的`getBoundingClientRect`

  * `modelMove`：对该卡调用`moveCard(cardId, toPosition)`

  * `pluginDispatch`：避让/放置插件返回的`moves/animations`

* 字段：

  * `ts`（性能时间戳）、`id`（卡片id）、`domLeft/domTop/transform/position/zIndex/transition`

  * `rect:{left,top,width,height}`、`model:{x,y}`、`shadow:{left,top}`、`unit/gap/columns/padding`

  * 输入事件坐标：`clientX/clientY`

## 技术方案

* 新增`debugPlacementObserver.ts`（只在`window.__FG_DEBUG_PLACEMENT===true`时启用）：

  * `attachPlacementObserver(cardId, gridEl, getModelPos, getShadowRect, options)`：返回`detach()`

  * 内部：

    * `MutationObserver`监听`attributes`（`style/class`）与`attributeOldValue`，记录差异

    * 帧采样：`requestAnimationFrame(poll)`，快照`computedStyle`与`getBoundingClientRect`

    * 输出统一`console.log('[DBG]', JSON.stringify(entry))`

* 在`BentoGrid.vue`：

  * `handleDragStart`记录`placementCandidateId`与容器`paddingLeft/Top`

  * `handleMouseUp/handleDrop`开启观察：`observer = attachPlacementObserver(draggedCard.id, gridEl, () => draggedCard.position, () => dropRect, {unit,gap,columns,padding})`

  * 在动画完成或超时`duration+200ms`后`observer.detach()`

  * 在每次`moveCard`调用前后输出`modelMove`日志（仅限当前卡片）

  * 在每次`plugins.dispatch`返回时，对于当前卡，输出`pluginDispatch`日志（`moves/animations`）

## 输出格式示例

```json
{"type":"placementStart","id":"card-123","ts":123.45}
{"type":"stylePoll","id":"card-123","ts":124.00,"domLeft":"608.5px","domTop":"422px","transform":"translate(0px,0px)","position":"absolute","transition":"left 300ms ..."}
{"type":"mutation","id":"card-123","ts":124.10,"styleDelta":{"transform":"translate(234px,0)"}}
{"type":"pluginDispatch","id":"card-123","ts":124.20,"animations":[{"from":{"x":2,"y":2},"to":{"x":4,"y":2},"duration":300}]}
{"type":"modelMove","id":"card-123","ts":124.40,"model":{"x":4,"y":2}}
{"type":"placementEnd","id":"card-123","ts":124.60}
```

## 使用说明

* 在浏览器控制台先执行：`window.__FG_DEBUG_PLACEMENT = true`

* 正常拖拽并松开；控制台输出`[DBG]`日志行

* 把完整日志粘贴给我即可（尽量包括从`placementStart`到`placementEnd`的所有行）

## 交付与变更范围

* 新增工具文件`src/debug/debugPlacementObserver.ts`

* 在`BentoGrid.vue`注入调用点与日志打印，不改变现有动画逻辑（保证可回滚）

## 后续

* 根据日志判断是否发生：

  * 模型在动画开始前被重置

  * `left/top`过渡与`transform`叠加引起的二段路径

  * 阴影像素与模型像素坐标系不一致（padding/scroll/border）

* 若确认根因，切换到“transform-only单通道动画”的实现计划并提交修复。

